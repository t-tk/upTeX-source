\newif\ifuptexmode\uptexmodefalse

\ifnum\jis"2121="3000

 %% for upLaTeX
 \documentclass{ujarticle}
 \def\pLaTeXorupLaTeX{upLaTeX}
 \uptexmodetrue
 \def\innerencoding{UPTEX}
 \def\tounicode{pdf:tounicode UTF8-UCS2}

\else

 %% for pLaTeX
 \documentclass{jarticle}
 \def\pLaTeXorupLaTeX{pLaTeX}
 \uptexmodefalse

 \ifnum\jis"2121="A1A1
  \def\innerencoding{EUC}
  \def\tounicode{pdf:tounicode EUC-UCS2}
 \fi
 \ifnum\jis"2121="8140
  \def\innerencoding{SJIS}
  \def\tounicode{pdf:tounicode 90ms-RKSJ-UCS2}
 \fi

\fi

\usepackage{graphicx}

%%%%%%%%
% hyperref 関連の制御をコマンドラインから行う
% (1),(2),(3) のどれかを実行すればよい。
%   (1) 何もしない
%   $ uplatex bkmk-jis.tex
%   (2) hyperref + dvipdfmx
%   $ uplatex "\def\withhyperref{dvipdfmx}\input" bkmk-jis.tex
%   (3) hyperref + dvips + modified convert-euc.txt + distiller/ps2pdf
%       hyperref + dvips + convbkmk.rb + distiller/ps2pdf
%   $ uplatex "\def\withhyperref{dvips}\input" bkmk-jis.tex
%%%%%%
\makeatletter
\def\@dvipdfmx{dvipdfmx}
\def\@dvips{dvips}

\ifx\withhyperref\@undefined
 \def\withhyperref{undefined}
\else

\ifx\withhyperref\@dvipdfmx
 \def\@hyperrefkeyval{dvipdfm}
\fi
\ifx\withhyperref\@dvips
 \def\@hyperrefkeyval{dvips}
\fi

\usepackage[\@hyperrefkeyval,%
bookmarks=true,%
bookmarksnumbered=true,%
bookmarkstype=toc,%
%pdfstartview={FitBH -32768},%
pdftitle={いろいろ確かめてみる},%
pdfsubject={hyperref編},%
pdfauthor={名無 権兵衛},%
pdfkeywords={TeX; dvips; dvipdfmx; bookmark; hyperref; しおり; pdf}%
]{hyperref}

\fi

\ifx\withhyperref\@dvipdfmx
 \AtBeginDvi{\special{\tounicode}}
\fi

\makeatother

\title{いろいろ確かめてみる}

\author{名無 権兵衛}

\oddsidemargin0mm
\evensidemargin0mm
\topmargin-15mm
\textwidth162mm
\textheight245mm

\begin{document}
\maketitle
\section{section title by ASCII}
test test.

hyperref with: \withhyperref
\typeout{### hyperref with: \withhyperref}

pLaTeX or upLaTeX: \pLaTeXorupLaTeX
\typeout{### pLaTeX or upLaTeX: \pLaTeXorupLaTeX}

inner encoding: \innerencoding
\typeout{### inner encoding: \innerencoding}

\begin{figure}
 \begin{center}
  \scalebox{0.2}{\includegraphics{box-jis.eps}}
  \caption{JISで符号化されたEPSファイル}
  \label{fig:box-jis}
 \end{center}
\end{figure}
%\begin{figure}
% \begin{center}
%  \scalebox{0.2}{\includegraphics{box-sjis.eps}}
%  \caption{Shift\_JISで符号化されたEPSファイル}
%  \label{fig:box-sjis}
% \end{center}
%\end{figure}
%\begin{figure}
% \begin{center}
%  \scalebox{0.2}{\includegraphics{box-euc.eps}}
%  \caption{EUC-JPで符号化されたEPSファイル}
%  \label{fig:box-euc}
% \end{center}
%\end{figure}
%\begin{figure}
% \begin{center}
%  \scalebox{0.2}{\includegraphics{box-utf8.eps}}
%  \caption{UTF-8で符号化されたEPSファイル}
%  \label{fig:box-utf8}
% \end{center}
%\end{figure}
\section{αβγ}
test test.

\section{абв}
test test.

\section{セクション}
test test.
\subsection{サブセクション(括弧)}
test test.

\end{document}
